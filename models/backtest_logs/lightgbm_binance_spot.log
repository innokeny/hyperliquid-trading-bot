Data shape after filtering: (2809, 5)
Calculating ML features...
ML features calculated. Shape after feature engineering: (2809, 25)
Creating ATR-based target variable...
Target variable created. Distribution:
target
0    0.703097
1    0.296903
Name: proportion, dtype: float64

--- Starting ML Model Training Phase ---
Pre-calculating Donchian/Pos for ML training (5d)...
Pre-calculating Donchian/Pos for ML training (10d)...
Pre-calculating Donchian/Pos for ML training (20d)...
Pre-calculating Donchian/Pos for ML training (30d)...
Pre-calculating Donchian/Pos for ML training (60d)...
Pre-calculating Donchian/Pos for ML training (90d)...
Pre-calculating Donchian/Pos for ML training (150d)...
Pre-calculating Donchian/Pos for ML training (250d)...
Pre-calculating Donchian/Pos for ML training (360d)...

--- Training ML Model for Timeframe 5 ---
Total signal events for ML (5d): 58
Train samples: 37, Valid samples: 10, Test samples: 11
Performing feature selection...
Dropped due to high correlation: []
Features remaining after correlation filter: 17
Dropped due to low mutual information: ['mom_10d', 'mom_30d', 'stochd_14_3_3', 'macd_hist', 'adx_14', 'plus_di_14', 'volatility_90d']
Final selected features: 10
Calculated scale_pos_weight: 0.76
Starting hyperparameter tuning with Optuna...
Optuna best AUC: 0.6156
Optuna best params: {'n_estimators': 100, 'learning_rate': 0.06581237521156892, 'num_leaves': 100, 'max_depth': 8, 'reg_alpha': 0.020695575725389666, 'reg_lambda': 4.388098939644617e-06, 'colsample_bytree': 0.6070262214034734, 'subsample': 0.8048151283477433, 'min_child_samples': 5}
Training final LightGBM model with best parameters...
Evaluating on validation set to find threshold...
Optimal threshold (Max F1 on Valid) found: 0.6992
Validation F1 @ optimal threshold: 0.7500
Validation Precision @ optimal threshold: 0.6000
Validation Recall @ optimal threshold: 1.0000

--- Test Set Evaluation Metrics (Threshold = 0.6992) ---
Accuracy:  0.7273
Precision: 0.4000
Recall:    1.0000
F1 Score:  0.5714
AUC:       0.8889
Log Loss:  0.9980
----------------------------------------------------
--- ML Model Training Complete ---

--- Training ML Model for Timeframe 10 ---
Total signal events for ML (10d): 58
Train samples: 37, Valid samples: 10, Test samples: 11
Performing feature selection...
Dropped due to high correlation: []
Features remaining after correlation filter: 17
Dropped due to low mutual information: ['mom_10d', 'mom_30d', 'stochd_14_3_3', 'macd_hist', 'adx_14', 'plus_di_14', 'volatility_90d']
Final selected features: 10
Calculated scale_pos_weight: 0.76
Starting hyperparameter tuning with Optuna...
Optuna best AUC: 0.6114
Optuna best params: {'n_estimators': 400, 'learning_rate': 0.010948326885180285, 'num_leaves': 45, 'max_depth': 10, 'reg_alpha': 0.019363035621543883, 'reg_lambda': 0.05000638078380661, 'colsample_bytree': 0.6223584607766498, 'subsample': 0.9276934906439565, 'min_child_samples': 6}
Training final LightGBM model with best parameters...
Evaluating on validation set to find threshold...
Optimal threshold (Max F1 on Valid) found: 0.5714
Validation F1 @ optimal threshold: 0.8571
Validation Precision @ optimal threshold: 0.7500
Validation Recall @ optimal threshold: 1.0000

--- Test Set Evaluation Metrics (Threshold = 0.5714) ---
Accuracy:  0.7273
Precision: 0.4000
Recall:    1.0000
F1 Score:  0.5714
AUC:       0.8611
Log Loss:  0.7889
----------------------------------------------------
--- ML Model Training Complete ---

--- Training ML Model for Timeframe 20 ---
Total signal events for ML (20d): 58
Train samples: 37, Valid samples: 10, Test samples: 11
Performing feature selection...
Dropped due to high correlation: []
Features remaining after correlation filter: 17
Dropped due to low mutual information: ['mom_10d', 'mom_30d', 'stochd_14_3_3', 'macd_hist', 'adx_14', 'plus_di_14', 'volatility_90d']
Final selected features: 10
Calculated scale_pos_weight: 0.76
Starting hyperparameter tuning with Optuna...
Optuna best AUC: 0.6600
Optuna best params: {'n_estimators': 800, 'learning_rate': 0.0681413460733914, 'num_leaves': 43, 'max_depth': 4, 'reg_alpha': 5.157454069813973e-07, 'reg_lambda': 0.04628916384765226, 'colsample_bytree': 0.7067773605630561, 'subsample': 0.9164240971993466, 'min_child_samples': 5}
Training final LightGBM model with best parameters...
Evaluating on validation set to find threshold...
Optimal threshold (Max F1 on Valid) found: 0.6219
Validation F1 @ optimal threshold: 0.8571
Validation Precision @ optimal threshold: 0.7500
Validation Recall @ optimal threshold: 1.0000

--- Test Set Evaluation Metrics (Threshold = 0.6219) ---
Accuracy:  0.5455
Precision: 0.2857
Recall:    1.0000
F1 Score:  0.4444
AUC:       0.8333
Log Loss:  0.8673
----------------------------------------------------
--- ML Model Training Complete ---

--- Training ML Model for Timeframe 30 ---
Total signal events for ML (30d): 58
Train samples: 37, Valid samples: 10, Test samples: 11
Performing feature selection...
Dropped due to high correlation: []
Features remaining after correlation filter: 17
Dropped due to low mutual information: ['mom_10d', 'mom_30d', 'stochd_14_3_3', 'macd_hist', 'adx_14', 'plus_di_14', 'volatility_90d']
Final selected features: 10
Calculated scale_pos_weight: 0.76
Starting hyperparameter tuning with Optuna...
Optuna best AUC: 0.6378
Optuna best params: {'n_estimators': 400, 'learning_rate': 0.02367944839171243, 'num_leaves': 64, 'max_depth': 5, 'reg_alpha': 0.030654078288930124, 'reg_lambda': 0.007923732471270558, 'colsample_bytree': 0.6058559812059537, 'subsample': 0.8181655372966533, 'min_child_samples': 5}
Training final LightGBM model with best parameters...
Evaluating on validation set to find threshold...
Optimal threshold (Max F1 on Valid) found: 0.6287
Validation F1 @ optimal threshold: 0.7500
Validation Precision @ optimal threshold: 0.6000
Validation Recall @ optimal threshold: 1.0000

--- Test Set Evaluation Metrics (Threshold = 0.6287) ---
Accuracy:  0.6364
Precision: 0.3333
Recall:    1.0000
F1 Score:  0.5000
AUC:       0.8889
Log Loss:  0.8720
----------------------------------------------------
--- ML Model Training Complete ---

--- Training ML Model for Timeframe 60 ---
Total signal events for ML (60d): 58
Train samples: 37, Valid samples: 10, Test samples: 11
Performing feature selection...
Dropped due to high correlation: []
Features remaining after correlation filter: 17
Dropped due to low mutual information: ['mom_10d', 'mom_30d', 'stochd_14_3_3', 'macd_hist', 'adx_14', 'plus_di_14', 'volatility_90d']
Final selected features: 10
Calculated scale_pos_weight: 0.76
Starting hyperparameter tuning with Optuna...
Optuna best AUC: 0.6378
Optuna best params: {'n_estimators': 1000, 'learning_rate': 0.0912090129838185, 'num_leaves': 23, 'max_depth': 6, 'reg_alpha': 0.000943779389330672, 'reg_lambda': 0.0009345866779622364, 'colsample_bytree': 0.7399763656334404, 'subsample': 0.7032446736034934, 'min_child_samples': 5}
Training final LightGBM model with best parameters...
Evaluating on validation set to find threshold...
Optimal threshold (Max F1 on Valid) found: 0.6501
Validation F1 @ optimal threshold: 0.8571
Validation Precision @ optimal threshold: 0.7500
Validation Recall @ optimal threshold: 1.0000

--- Test Set Evaluation Metrics (Threshold = 0.6501) ---
Accuracy:  0.5455
Precision: 0.2857
Recall:    1.0000
F1 Score:  0.4444
AUC:       0.7778
Log Loss:  0.9624
----------------------------------------------------
--- ML Model Training Complete ---

--- Training ML Model for Timeframe 90 ---
Total signal events for ML (90d): 58
Train samples: 37, Valid samples: 10, Test samples: 11
Performing feature selection...
Dropped due to high correlation: []
Features remaining after correlation filter: 17
Dropped due to low mutual information: ['mom_10d', 'mom_30d', 'stochd_14_3_3', 'macd_hist', 'adx_14', 'plus_di_14', 'volatility_90d']
Final selected features: 10
Calculated scale_pos_weight: 0.76
Starting hyperparameter tuning with Optuna...
Optuna best AUC: 0.6378
Optuna best params: {'n_estimators': 900, 'learning_rate': 0.036757035120599406, 'num_leaves': 40, 'max_depth': 4, 'reg_alpha': 0.006554975945364977, 'reg_lambda': 0.00013696851803986833, 'colsample_bytree': 0.6263103863759433, 'subsample': 0.7991552786064197, 'min_child_samples': 5}
Training final LightGBM model with best parameters...
Evaluating on validation set to find threshold...
Optimal threshold (Max F1 on Valid) found: 0.5848
Validation F1 @ optimal threshold: 0.7500
Validation Precision @ optimal threshold: 0.6000
Validation Recall @ optimal threshold: 1.0000

--- Test Set Evaluation Metrics (Threshold = 0.5848) ---
Accuracy:  0.5455
Precision: 0.2857
Recall:    1.0000
F1 Score:  0.4444
AUC:       0.7778
Log Loss:  0.8174
----------------------------------------------------
--- ML Model Training Complete ---

--- Training ML Model for Timeframe 150 ---
Total signal events for ML (150d): 58
Train samples: 37, Valid samples: 10, Test samples: 11
Performing feature selection...
Dropped due to high correlation: []
Features remaining after correlation filter: 17
Dropped due to low mutual information: ['mom_10d', 'mom_30d', 'stochd_14_3_3', 'macd_hist', 'adx_14', 'plus_di_14', 'volatility_90d']
Final selected features: 10
Calculated scale_pos_weight: 0.76
Starting hyperparameter tuning with Optuna...
Optuna best AUC: 0.6378
Optuna best params: {'n_estimators': 400, 'learning_rate': 0.06663145693421546, 'num_leaves': 83, 'max_depth': 4, 'reg_alpha': 0.001326711242976835, 'reg_lambda': 1.6978657935379311e-06, 'colsample_bytree': 0.707310781585563, 'subsample': 0.7173042411100735, 'min_child_samples': 5}
Training final LightGBM model with best parameters...
Evaluating on validation set to find threshold...
Optimal threshold (Max F1 on Valid) found: 0.6235
Validation F1 @ optimal threshold: 0.8571
Validation Precision @ optimal threshold: 0.7500
Validation Recall @ optimal threshold: 1.0000

--- Test Set Evaluation Metrics (Threshold = 0.6235) ---
Accuracy:  0.5455
Precision: 0.2857
Recall:    1.0000
F1 Score:  0.4444
AUC:       0.7778
Log Loss:  0.8709
----------------------------------------------------
--- ML Model Training Complete ---

--- Training ML Model for Timeframe 250 ---
Total signal events for ML (250d): 58
Train samples: 37, Valid samples: 10, Test samples: 11
Performing feature selection...
Dropped due to high correlation: []
Features remaining after correlation filter: 17
Dropped due to low mutual information: ['mom_10d', 'mom_30d', 'stochd_14_3_3', 'macd_hist', 'adx_14', 'plus_di_14', 'volatility_90d']
Final selected features: 10
Calculated scale_pos_weight: 0.76
Starting hyperparameter tuning with Optuna...
Optuna best AUC: 0.6225
Optuna best params: {'n_estimators': 800, 'learning_rate': 0.038295209613880506, 'num_leaves': 35, 'max_depth': 5, 'reg_alpha': 0.043787032960617145, 'reg_lambda': 0.049074571782718485, 'colsample_bytree': 0.8966172519342344, 'subsample': 0.7835967143139886, 'min_child_samples': 6}
Training final LightGBM model with best parameters...
Evaluating on validation set to find threshold...
Optimal threshold (Max F1 on Valid) found: 0.5875
Validation F1 @ optimal threshold: 0.8571
Validation Precision @ optimal threshold: 0.7500
Validation Recall @ optimal threshold: 1.0000

--- Test Set Evaluation Metrics (Threshold = 0.5875) ---
Accuracy:  0.4545
Precision: 0.2500
Recall:    1.0000
F1 Score:  0.4000
AUC:       0.9167
Log Loss:  0.8598
----------------------------------------------------
--- ML Model Training Complete ---

--- Training ML Model for Timeframe 360 ---
Total signal events for ML (360d): 58
Train samples: 37, Valid samples: 10, Test samples: 11
Performing feature selection...
Dropped due to high correlation: []
Features remaining after correlation filter: 17
Dropped due to low mutual information: ['mom_10d', 'mom_30d', 'stochd_14_3_3', 'macd_hist', 'adx_14', 'plus_di_14', 'volatility_90d']
Final selected features: 10
Calculated scale_pos_weight: 0.76
Starting hyperparameter tuning with Optuna...
Optuna best AUC: 0.6600
Optuna best params: {'n_estimators': 600, 'learning_rate': 0.06535646543654046, 'num_leaves': 37, 'max_depth': 7, 'reg_alpha': 4.623308765530589e-06, 'reg_lambda': 0.03288715334558187, 'colsample_bytree': 0.6630613966435333, 'subsample': 0.6603402009301511, 'min_child_samples': 5}
Training final LightGBM model with best parameters...
Evaluating on validation set to find threshold...
Optimal threshold (Max F1 on Valid) found: 0.6185
Validation F1 @ optimal threshold: 0.8571
Validation Precision @ optimal threshold: 0.7500
Validation Recall @ optimal threshold: 1.0000

--- Test Set Evaluation Metrics (Threshold = 0.6185) ---
Accuracy:  0.5455
Precision: 0.2857
Recall:    1.0000
F1 Score:  0.4444
AUC:       0.8333
Log Loss:  0.8737
----------------------------------------------------
--- ML Model Training Complete ---
--- ML Model Training Phase Complete ---

--- Starting Backtesting Phase ---
Backtesting lookback window: 5 days...
Finished backtesting & metrics for window: 5
Backtesting lookback window: 10 days...
Finished backtesting & metrics for window: 10
Backtesting lookback window: 20 days...
Finished backtesting & metrics for window: 20
Backtesting lookback window: 30 days...
Finished backtesting & metrics for window: 30
Backtesting lookback window: 60 days...
Finished backtesting & metrics for window: 60
Backtesting lookback window: 90 days...
Finished backtesting & metrics for window: 90
Backtesting lookback window: 150 days...
Finished backtesting & metrics for window: 150
Backtesting lookback window: 250 days...
Finished backtesting & metrics for window: 250
Backtesting lookback window: 360 days...
Finished backtesting & metrics for window: 360

--- Backtest Metrics Summary ---
ML Strategy Metrics:
Lookback Window: 5d days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          25.67%
Annualized Volatility:         15.25%
Sharpe Ratio:                  1.11
Sortino Ratio:                 0.95
Max Drawdown:                  -16.80%
Calmar Ratio:                  1.53
----------------------------------------
Cumulative Return (Strategy):  479.05%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)


Lookback Window: 10d days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          23.10%
Annualized Volatility:         15.29%
Sharpe Ratio:                  1.01
Sortino Ratio:                 0.88
Max Drawdown:                  -16.80%
Calmar Ratio:                  1.38
----------------------------------------
Cumulative Return (Strategy):  394.02%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)


Lookback Window: 20d days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          24.95%
Annualized Volatility:         15.66%
Sharpe Ratio:                  1.06
Sortino Ratio:                 0.94
Max Drawdown:                  -21.54%
Calmar Ratio:                  1.16
----------------------------------------
Cumulative Return (Strategy):  454.01%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)


Lookback Window: 30d days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          24.51%
Annualized Volatility:         15.27%
Sharpe Ratio:                  1.07
Sortino Ratio:                 0.91
Max Drawdown:                  -21.40%
Calmar Ratio:                  1.15
----------------------------------------
Cumulative Return (Strategy):  439.19%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)


Lookback Window: 60d days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          25.01%
Annualized Volatility:         15.66%
Sharpe Ratio:                  1.06
Sortino Ratio:                 0.94
Max Drawdown:                  -21.54%
Calmar Ratio:                  1.16
----------------------------------------
Cumulative Return (Strategy):  455.83%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)


Lookback Window: 90d days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          24.95%
Annualized Volatility:         15.46%
Sharpe Ratio:                  1.07
Sortino Ratio:                 0.93
Max Drawdown:                  -21.54%
Calmar Ratio:                  1.16
----------------------------------------
Cumulative Return (Strategy):  454.05%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)


Lookback Window: 150d days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          24.95%
Annualized Volatility:         15.66%
Sharpe Ratio:                  1.06
Sortino Ratio:                 0.94
Max Drawdown:                  -21.54%
Calmar Ratio:                  1.16
----------------------------------------
Cumulative Return (Strategy):  454.01%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)


Lookback Window: 250d days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          23.30%
Annualized Volatility:         15.66%
Sharpe Ratio:                  1.00
Sortino Ratio:                 0.89
Max Drawdown:                  -25.80%
Calmar Ratio:                  0.90
----------------------------------------
Cumulative Return (Strategy):  400.08%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)


Lookback Window: 360d days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          24.77%
Annualized Volatility:         15.67%
Sharpe Ratio:                  1.05
Sortino Ratio:                 0.94
Max Drawdown:                  -21.54%
Calmar Ratio:                  1.15
----------------------------------------
Cumulative Return (Strategy):  447.92%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)


Lookback Window: Combo days
Period: 2017-08-18 to 2025-04-25 (7.69 years)
CAGR:                          24.62%
Annualized Volatility:         15.37%
Sharpe Ratio:                  1.06
Sortino Ratio:                 0.95
Max Drawdown:                  -20.96%
Calmar Ratio:                  1.17
----------------------------------------
Cumulative Return (Strategy):  442.67%
Cumulative Return (Buy & Hold):493.64%
----------------------------------------
Total Trades:                  Not Calculated (Ensemble)
Win Rate:                      Not Calculated (Ensemble)
Gain:Loss Ratio:               Not Calculated (Ensemble)



Subset of results saved to /Users/a.tikhonov/ml_dl_projects/applied_ai_blockchain/data/1d_timeframe/spot/binance_spot_ETH_USDT_1d_20150425_20250425_strategy_output_ml_enhanced.csv
